<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¥é¾è¨˜ç‰Œå°å·¥å…· (æœ€å¤§è¨˜æ†¶ï¼š200 æ­¥)</title>
  <style>
    /* (CSS æ¨£å¼ä¿æŒä¸è®Šï¼Œç•¥) */
    /* ========== æ·±è‰²æ¨¡å¼åŸºç¤è¨­å®š ========== */
    body { 
      font-family: 'Microsoft JhengHei', Arial, sans-serif; 
      text-align: center; 
      background: #282c34; 
      color: #f0f0f0; 
      font-size: 18px; 
      margin: 15px;
    }
    
    h2 {
      color: #61dafb; 
      margin-bottom: 15px;
    }
    
    /* ========== é€šç”¨æŒ‰éˆ•æ¨£å¼ ========== */
    button { 
      font-size: 20px;  
      margin: 4px; 
      padding: 8px 12px; 
      border-radius: 6px; 
      cursor: pointer;
      border: 1px solid #555; 
      background: #3a3f47; 
      color: #f0f0f0;
      min-width: 40px; 
      transition: background-color 0.2s;
      touch-action: manipulation;
    }
    
    button:hover {
      background-color: #4c525d; 
    }

    /* ç´…è‰²èŠ±è‰²æ–‡å­— (åªæœ‰æ–‡å­—è®Šè‰²) */
    .red-text-suit {
        color: #e74c3c !important; 
    }

    /* ========== é»æ“Šå¾Œä¿æŒçš„é¸ä¸­ç‹€æ…‹ (é©ç”¨æ–¼èŠ±è‰²å’Œæ•¸å­—) ========== */
    .suit-group button.selected,
    .rank-group button.selected { 
        background: #61dafb; 
        color: #1e1e1e !important; 
        border: 1px solid #61dafb;
        box-shadow: 0 0 5px #61dafb;
    }

    /* èŠ±è‰²ç¬¦è™Ÿæ”¾å¤§æ¨£å¼ */
    .suit-icon {
        font-size: 28px; 
        color: inherit; 
    }
    /* ç¢ºä¿ç´…è‰²èŠ±è‰²ç¬¦è™Ÿçš„é¡è‰² */
    .red-text-suit .suit-icon {
        color: #e74c3c !important; 
    }

    /* ========== é ‚éƒ¨æ§åˆ¶å€ï¼šä¸‰æ¬„å¼å°é½Š ========== */
    .top-alignment-wrapper {
        max-width: 643px; 
        margin: 10px auto; 
    }

    .top-selection {
        display: flex;
        justify-content: space-between;
        align-items: center; 
        width: 100%; 
    }

    .top-left-col {
        width: 105px; 
        box-sizing: border-box; 
        display: flex;
        justify-content: flex-start; 
        padding-right: 15px;
    }

    .top-right-spacer {
        width: 105px; 
        height: 1px;
        flex-shrink: 0;
    }

    /* ========== [å…¨éƒ¨æ¸…é™¤] æŒ‰éˆ• ========== */
    .clear-all { 
      width: 90px; 
      background: #e74c3c; 
      box-shadow: 0 3px 0 #c0392b;
      font-size: 16px; 
      display: flex;
      flex-direction: column; 
      align-items: center;
      padding: 8px 8px; 
      margin: 0; 
      flex-shrink: 0; 
    }
    .clear-all .clear-icon {
        font-size: 24px; 
        margin-right: 0;
        margin-bottom: 2px;
    }
    .clear-all:hover {
      background: #c0392b;
      transform: translateY(1px);
      box-shadow: 0 2px 0 #a03020;
    }


    /* ========== 2. é¸æ“‡å€åŸŸå…§å…ƒä»¶æ¨£å¼ (ä¸­é–“éƒ¨åˆ†) ========== */
    .selection-area {
        display: flex;
        align-items: center; 
        width: 433px; 
        justify-content: flex-start; 
        flex-shrink: 1; 
    }

    /* èŠ±è‰²æŒ‰éˆ•å®¹å™¨ (2x2) */
    .suit-group {
      display: grid;
      grid-template-columns: repeat(2, auto);
      gap: 1px; 
      margin-right: 8px; 
    }
    
    /* èŠ±è‰²æŒ‰éˆ•åŠ å¤§ */
    .suit-group button {
        padding: 10px 10px; 
        min-width: 50px;
    }

    /* æ•¸å­—æŒ‰éˆ•å®¹å™¨ (A-6, 7-K) */
    .rank-group {
      display: flex;
      flex-direction: column;
      margin-right: -70px; 
      flex-shrink: 0;
    }

    /* æ•¸å­—æŒ‰éˆ•çš„æ¯ä¸€è¡Œ */
    .rank-row { 
      display: flex;
      flex-wrap: nowrap;
      justify-content: flex-start;
      margin: 0;
      padding: 0;
    }

    /* ========== è¨˜ç‰Œæ§½ç¶²æ ¼ & è¨˜ç‰Œæ§½æ¨£å¼ ========== */
    .grid { 
      display: grid; 
      grid-template-columns: repeat(6, 68px); 
      gap: 5px; 
      justify-content: center; 
      max-width: 510px; 
      padding: 5px;
      background: #3a3f47;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.5); 
    }
    
    .slot { 
      width: 68px;  
      height: 50px; 
      font-size: 24px;  
      border: 3px solid #555; 
      border-radius: 8px;
      background: #1e1e1e;
      color: #f0f0f0; 
      margin: 0; 
      display: flex; 
      align-items: center;
      justify-content: center;
      font-weight: bold;
      touch-action: manipulation;
    }
    .slot[style*="color: red"] {
        color: #ff6b6b !important; 
    }


    /* ========== è¨˜ç‰Œå€ç¸½å®¹å™¨ & å´é‚Šæ¬„ ========== */
    .main-area {
      display: flex;
      justify-content: center;
      align-items: flex-start; 
      margin: 10px auto;
      max-width: 720px; 
    }
    
    .left-sidebar-buttons { 
      display: flex;
      flex-direction: column; 
      width: 90px; 
      margin-right: 15px; 
      padding-top: 5px; 
    }

    .right-sidebar-buttons { 
      display: flex;
      flex-direction: column; 
      width: 90px; 
      margin-left: 15px; 
      padding-top: 5px; 
    }

    /* ========== å´é‚ŠæŒ‰éˆ•æ¨£å¼ (é€šç”¨) ========== */
    .clear-button { 
      font-size: 16px; 
      padding: 8px 8px; 
      margin: 5px 0;
      border-radius: 6px;
      color: white; 
      border: none;
      width: 90px; 
      display: flex;
      flex-direction: column; 
      align-items: center;
    }

    .clear-icon {
      font-size: 24px; 
      margin-bottom: 2px; 
    }
    
    .bookmark-button {
      background: #f1c40f; 
      box-shadow: 0 3px 0 #d1ac0d;
      color: #333; 
    }
    .bookmark-button:hover {
      background: #d1ac0d;
      transform: translateY(1px);
      box-shadow: 0 2px 0 #b3910c;
    }
    .bookmark-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
      background: #555 !important;
    }


    .clear-empty { 
      background: #2ecc71; 
      box-shadow: 0 3px 0 #27ae60;
    }
    .clear-empty:hover {
      background: #27ae60;
      transform: translateY(1px);
      box-shadow: 0 2px 0 #219d55;
    }

    .undo-button {
        background: #3498db; 
        box-shadow: 0 3px 0 #2980b9;
    }
    .undo-button:hover {
        background: #2980b9;
        transform: translateY(1px);
        box-shadow: 0 2px 0 #2071a1;
    }
    
    .redo-button {
        background: #1abc9c; 
        box-shadow: 0 3px 0 #16a085;
    }
    .redo-button:hover {
        background: #16a085;
        transform: translateY(1px);
        box-shadow: 0 2px 0 #148f77;
    }
  </style>
</head>
<body>

  <h2>æ¥é¾è¨˜ç‰Œå°å·¥å…· (æœ€å¤§è¨˜æ†¶ï¼š200 æ­¥)</h2>

  <div class="top-alignment-wrapper">
      <div class="top-selection">
          
          <div class="top-left-col">
              <button class="clear-all" onclick="clearAll()">
                  <span class="clear-icon">âŒ</span>
                  å…¨éƒ¨æ¸…é™¤
              </button>
          </div>

          <div class="selection-area">
              
              <div class="suit-group">
                  <button onclick="selectSuit('â™ ')"><span class="suit-icon">â™ </span></button>
                  <button class="red-text-suit" onclick="selectSuit('â™¥')"><span class="suit-icon">â™¥</span></button>
                  <button onclick="selectSuit('â™§')"><span class="suit-icon">â™§</span></button>
                  <button class="red-text-suit" onclick="selectSuit('â™¢')"><span class="suit-icon">â™¢</span></button>
              </div>

              <div class="rank-group">
                  <div class="rank-row">
                      <button onclick="selectRank('A')">A</button>
                      <button onclick="selectRank('2')">2</button>
                      <button onclick="selectRank('3')">3</button>
                      <button onclick="selectRank('4')">4</button>
                      <button onclick="selectRank('5')">5</button>
                      <button onclick="selectRank('6')">6</button>
                  </div>
                  <div class="rank-row">
                      <button onclick="selectRank('7')">7</button>
                      <button onclick="selectRank('8')">8</button>
                      <button onclick="selectRank('9')">9</button>
                      <button onclick="selectRank('10')">10</button>
                      <button onclick="selectRank('J')">J</button>
                      <button onclick="selectRank('Q')">Q</button>
                      <button onclick="selectRank('K')">K</button>
                  </div>
              </div>
          </div>

          <div class="top-right-spacer"></div>
      </div>
  </div>
  
  <div class="main-area">
      <div class="left-sidebar-buttons">
          
          <button class="clear-button clear-empty" onclick="removeEmptySlots()">
              <span class="clear-icon">ğŸ—‘ï¸</span>
              æ¸…é™¤ç©ºæ ¼
          </button>
          
          <button class="clear-button undo-button" onclick="undo()">
              <span class="clear-icon">â†¶</span>
              å¾©åŸ
          </button>
          
          <button class="clear-button redo-button" onclick="redo()">
              <span class="clear-icon">â†±</span>
              åå¾©åŸ
          </button>

      </div>
      
      <div class="grid" id="slots"></div>

      <div class="right-sidebar-buttons">
          <button class="clear-button bookmark-button" onclick="saveBookmark()">
              <span class="clear-icon">ğŸ”–</span>
              ç´€éŒ„
          </button>
          
          <button class="clear-button bookmark-button" id="loadBookmarkBtn" onclick="loadBookmark()">
              <span class="clear-icon">ğŸ”™</span>
              è¿”å›ç´€éŒ„
          </button>
      </div>
  </div>


  <script>
    // ç•¶å‰é¸ä¸­ä¸”é«˜äº®çš„ç‹€æ…‹ (é»æ“ŠæŒ‰éˆ•æ™‚æœƒè¢«è³¦å€¼)
    let selectedSuit = ''; 
    let selectedRank = '';
    
    // ä¸Šæ¬¡æˆåŠŸè¨˜ç‰Œçš„çµæœ (ç”¨æ–¼å»¶çºŒ)
    let lastUsedSuit = '';
    let lastUsedRank = '';
    
    // ========== å¾©åŸ/åå¾©åŸ/è¨˜æ†¶é»åŠŸèƒ½ (æœªä¿®æ”¹ï¼Œç‹€æ…‹å„²å­˜é‚è¼¯å·²åŒ…å« lastUsed è®Šæ•¸) ==========
    let history = [];
    let redoStack = []; 
    const MAX_HISTORY = 200; 
    let bookmarkState = null; 

    function getCurrentState() {
        const slots = document.querySelectorAll('.slot');
        return {
            slots: Array.from(slots).map(s => {
                return {
                    content: s.innerText,
                    color: s.style.color
                };
            }),
            lastUsedSuit: lastUsedSuit,
            lastUsedRank: lastUsedRank
        };
    }

    function clearSelections() {
        // æ­¤å‡½æ•¸ç”¨æ–¼å¾¹åº•æ¸…é™¤é¸ä¸­è®Šæ•¸å’Œé«˜äº®ç‹€æ…‹ (ä¾›å¤–éƒ¨å·¥å…·å‡½æ•¸å¦‚ clearAll/loadState å‘¼å«)
        selectedSuit = ''; 
        selectedRank = '';
        document.querySelectorAll('.rank-group button').forEach(btn => btn.classList.remove('selected'));
        document.querySelectorAll('.suit-group button').forEach(btn => btn.classList.remove('selected'));
    }

    function loadState(state) {
        const slots = document.querySelectorAll('.slot');
        if (state.slots.length !== slots.length) return; 

        slots.forEach((s, index) => {
            const item = state.slots[index];
            s.innerText = item.content;
            s.style.color = item.color || '#f0f0f0'; 
        });
        
        lastUsedSuit = state.lastUsedSuit || '';
        lastUsedRank = state.lastUsedRank || '';
        
        // è¼‰å…¥ç‹€æ…‹å¾Œï¼Œæ¸…é™¤ç•¶å‰é¸ä¸­/é«˜äº®ç‹€æ…‹ï¼Œé˜²æ­¢æ··äº‚
        clearSelections(); 
    }

    function saveState() {
        const currentState = getCurrentState();
        
        if (history.length > 0) {
            const lastState = history[history.length - 1];
            if (JSON.stringify(lastState.slots) === JSON.stringify(currentState.slots) &&
                lastState.lastUsedSuit === currentState.lastUsedSuit &&
                lastState.lastUsedRank === currentState.lastUsedRank) {
                return; 
            }
        }

        if (history.length >= MAX_HISTORY) {
            history.shift(); 
        }
        history.push(currentState);
    }

    function undo() {
        if (history.length <= 1) {
            return;
        }
        
        const currentState = history.pop(); 
        redoStack.push(currentState);
        
        const previousState = history[history.length - 1];
        loadState(previousState);
    }

    function redo() {
        if (redoStack.length === 0) {
            return;
        }

        const nextState = redoStack.pop();
        loadState(nextState);
        history.push(nextState);
    }

    function updateBookmarkButtons() {
        const loadBtn = document.getElementById('loadBookmarkBtn');
        if (loadBtn) {
            loadBtn.disabled = (bookmarkState === null);
        }
    }

    function saveBookmark() {
        bookmarkState = getCurrentState();
        updateBookmarkButtons(); 
    }

    function loadBookmark() {
        if (bookmarkState === null) {
            return;
        }
        
        if (redoStack.length > 0) {
            redoStack = []; 
        }

        loadState(bookmarkState);
        saveState(); 
    }


    // ==========================================================
    // ** æ ¸å¿ƒå‹•ä½œå‡½æ•¸ (å·²èª¿æ•´ï¼šé«˜äº®ä¿æŒ, å–®æ“Šè¦†è“‹/å¡«å…¥, å¡«ç‰Œå¾Œé–å®šæ–°å¡«å…¥) **
    // ==========================================================

    function selectSuit(suit) {
      // 1. æ¸…é™¤æ‰€æœ‰èŠ±è‰²æŒ‰éˆ•çš„ selected ç‹€æ…‹ (åªå½±éŸ¿èŠ±è‰²çµ„)
      document.querySelectorAll('.suit-group button').forEach(btn => {
          btn.classList.remove('selected');
      });

      // 2. è¨­å®šæ–°çš„é¸ä¸­èŠ±è‰²
      selectedSuit = suit;
      
      // 3. æ‰¾åˆ°è¢«é»æ“Šçš„æŒ‰éˆ•ä¸¦åŠ ä¸Š selected ç‹€æ…‹
      document.querySelectorAll('.suit-group button').forEach(btn => {
          if (btn.querySelector('.suit-icon') && btn.querySelector('.suit-icon').innerText.trim() === suit) {
              btn.classList.add('selected');
          }
      });
      // ä¿æŒæ•¸å­—é«˜äº®ä¸è®Š
    }

    function selectRank(rank) {
      // 1. æ¸…é™¤æ‰€æœ‰æ•¸å­—æŒ‰éˆ•çš„ selected ç‹€æ…‹ (åªå½±éŸ¿æ•¸å­—çµ„)
      document.querySelectorAll('.rank-group button').forEach(btn => {
          btn.classList.remove('selected');
      });

      // 2. è¨­å®šæ–°çš„é¸ä¸­æ•¸å­—
      selectedRank = rank;

      // 3. æ‰¾åˆ°è¢«é»æ“Šçš„æŒ‰éˆ•ä¸¦åŠ ä¸Š selected ç‹€æ…‹
      document.querySelectorAll('.rank-group button').forEach(btn => {
          if (btn.innerText.trim() === rank) {
              btn.classList.add('selected');
          }
      });
      // ä¿æŒèŠ±è‰²é«˜äº®ä¸è®Š
    }

    function fillSlot(btn) {
        // ä»»ä½•æ–°å‹•ä½œå‰ï¼Œæ¸…ç©º Redo å †ç–Š
        if (redoStack.length > 0) {
            redoStack = [];
        }

        // 1. åˆ¤æ–·å°‡è¦ä½¿ç”¨çš„ç‰Œå‹ (åŒ…å«å»¶çºŒé‚è¼¯)
        let suitToUse = selectedSuit;
        let rankToUse = selectedRank;

        // --- å»¶çºŒé‚è¼¯åˆ¤æ–· ---
        if (suitToUse && !rankToUse) {
            // æƒ…æ³ä¸€ï¼šåªé¸äº†èŠ±è‰²ï¼Œä½¿ç”¨ä¸Šæ¬¡çš„æ•¸å­—å»¶çºŒ
            rankToUse = lastUsedRank;
        } else if (!suitToUse && rankToUse) {
            // æƒ…æ³äºŒï¼šåªé¸äº†æ•¸å­—ï¼Œä½¿ç”¨ä¸Šæ¬¡çš„èŠ±è‰²å»¶çºŒ
            suitToUse = lastUsedSuit;
        }
        
        const hasValidCardToFill = suitToUse && rankToUse;
        const isSlotFilled = btn.innerText !== '';

        if (!hasValidCardToFill) {
            // åªæœ‰ç•¶æ²’æœ‰é¸å®šè¦å¡«å…¥çš„ç‰Œæ™‚ï¼Œæ‰å…è¨±æ¸…é™¤å·²å¡«å…¥çš„æ§½ä½ï¼Œå¦å‰‡é˜»æ­¢å¡«ç‰Œ
            if (isSlotFilled) {
                // é»æ“Šå·²å¡«å…¥æ§½ä½ï¼Œä½†æ²’æœ‰æ–°ç‰Œè¦å¡« -> æ¸…é™¤è©²æ§½ä½
                btn.innerText = '';
                btn.style.color = '#f0f0f0';
                saveState();
                return;
            } else {
                // é»æ“Šç©ºç™½æ§½ä½ï¼Œä½†æ²’æœ‰æ–°ç‰Œè¦å¡« -> é˜»æ­¢å¡«ç‰Œ
                return;
            }
        }
        
        // --- åŸ·è¡Œå¡«ç‰Œ/è¦†è“‹ ---
        
        // å¡«å…¥/è¦†è“‹
        btn.innerText = suitToUse + rankToUse;
        
        // åˆ¤æ–·é¡è‰²
        if (suitToUse === 'â™¥' || suitToUse === 'â™¢') {
            btn.style.color = 'red';
        } else {
            btn.style.color = '#f0f0f0'; 
        }
        
        // 2. æ›´æ–°è¨˜æ†¶ç‹€æ…‹ (å»¶çºŒç‰Œå‹)
        lastUsedSuit = suitToUse;
        lastUsedRank = rankToUse;
        
        // 3. æ¸…é™¤é¸ä¸­è®Šæ•¸ (ä½†ä¿ç•™é«˜äº®æ¨£å¼)ï¼Œ**é–å®š**æ–°çš„å¡«å…¥ï¼Œé˜²æ­¢é€£çºŒé»æ“Šç©ºç™½æ§½ä½
        selectedSuit = ''; 
        selectedRank = '';
        
        saveState();
    }

    function clearAll() {
      if (confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ 36 å€‹è¨˜ç‰Œæ§½ã€èŠ±è‰²/æ•¸å­—é¸ä¸­ç‹€æ…‹ä»¥åŠä¸Šæ¬¡ç´€éŒ„çš„å»¶çºŒè¨˜æ†¶å—ï¼Ÿ")) {
          if (redoStack.length > 0) {
              redoStack = []; 
          }

          const slots = document.querySelectorAll('.slot');
          slots.forEach(s => {
              s.innerText = '';
              s.style.color = '#f0f0f0';
          });
          
          // æ¸…é™¤æ‰€æœ‰ç‹€æ…‹ (åŒ…æ‹¬é«˜äº®)
          clearSelections();
          lastUsedSuit = '';
          lastUsedRank = '';

          saveState(); 
      }
    }

    function removeEmptySlots() {
      if (redoStack.length > 0) {
          redoStack = []; 
      }

      const slots = Array.from(document.querySelectorAll('.slot'));
      const nonEmpty = slots.filter(s => s.innerText !== '');
      const slotsContainer = document.getElementById('slots');
      
      slotsContainer.innerHTML = '';
      nonEmpty.forEach(s => {
        slotsContainer.appendChild(s);
      });
      
      const totalSlots = 36;
      for (let i = nonEmpty.length; i < totalSlots; i++) {
        let b = document.createElement('button');
        b.className = 'slot';
        b.onclick = () => fillSlot(b);
        slotsContainer.appendChild(b);
      }
      
      saveState(); 
    }

    // åˆå§‹åŒ– 36 å€‹è¨˜ç‰Œæ§½
    const slotsContainer = document.getElementById('slots');
    for (let i = 0; i < 36; i++) {
      let b = document.createElement('button');
      b.className = 'slot';
      b.onclick = () => fillSlot(b);
      slotsContainer.appendChild(b);
    }

    // é é¢è¼‰å…¥å¾Œï¼Œå„²å­˜åˆå§‹ç‹€æ…‹ä¸¦æ›´æ–°ç´€éŒ„é»æŒ‰éˆ•ç‹€æ…‹
    window.onload = function() {
        saveState(); 
        updateBookmarkButtons(); 
    }
  </script>

</body>
</html>